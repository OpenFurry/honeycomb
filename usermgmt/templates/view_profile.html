{% extends "base.html" %}
{% load profile_extras %}

{% block content %}
{% if blocked_by %}
    <div class="alert alert-warning">You are blocked from viewing this profile by the owner</div>
{% else %}
        <div class="row profile-tabs">
            <div class="col-md-12">
                <ul class="nav nav-tabs">
                    <li role="presentation" class="active"><a href="{% url 'usermgmt:view_profile' user_profile.username %}">Profile</a></li>
                    <li role="presentation"><a href="{% url 'submissions:list_user_submissions' username=user_profile.username %}">Submissions</a></li>
                    <li role="presentation"><a href="#">Favorites</a></li>
                    {% if user.is_authenticated and user != user_profile %}
                        <li role="presentation" class="dropdown">
                            <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false">
                                Social <span class="caret"></span>
                            </a>
                            <ul class="dropdown-menu">
                                {% if watched %}
                                    <li><a><form action="{% url 'social:unwatch_user' user_profile.username%}" method="post">
                                        {% csrf_token %}
                                        <button class="link-button">
                                            Unfollow user
                                        </button>
                                    </form></a></li>
                                {% else %}
                                    {% if not blocked %}
                                        <li><a><form action="{% url 'social:watch_user' user_profile.username %}" method="post">
                                            {% csrf_token %}
                                            <button class="link-button">
                                                Follow user
                                            </button>
                                        </form></a></li>
                                    {% endif %}
                                {% endif %}
                                {% if blocked %}
                                    <li><a><form action="{% url 'social:unblock_user' user_profile.username %}" method="post">
                                        {% csrf_token %}
                                        <button class="link-button">
                                            Unblock user
                                        </button>
                                    </form></a></li>
                                {% else %}
                                    <li><a><form action="{% url 'social:block_user' user_profile.username %}" method="post">
                                        {% csrf_token %}
                                        <button class="link-button">
                                            Block user
                                        </button>
                                    </form></a></li>
                                    <li><a><form action="{% url 'social:message_user' user_profile.username %}" method="post">
                                        {% csrf_token %}
                                        <button class="link-button">
                                            Message user
                                        </button>
                                    </form></a></li>
                                {% endif %}
                            </ul>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    <div class="row">
        <div class="col-md-9">
            <div class="panel panel-default">
                <div class="panel-heading">
                    Profile
                </div>
                <div class="panel-body">
                    {{ user_profile.profile.profile_rendered|safe }}
                </div>
                <div class="panel-footer">
                    {{ user_profile.profile.attributes|render_attributes }}
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="panel panel-default">
                <div class="panel-heading">
                    Details
                </div>
                <div class="panel-body">
                    <dl>
                        <dt>Date joined</dt>
                        <dd>{{ user_profile.date_joined|date }}</dd>

                        <dt>Last login</dt>
                        <dd>{{ user_profile.last_login|date }}</dd>

                        <dt>Submissions</dt>
                        <dd>{{ user_profile.submission_set.count }}</dd>

                        <dt>Comments</dt>
                        <dd>{{ user_profile.comment_set.count }}</dd>

                        <dt>Favorites</dt>
                        <dd>{{ user_profile.profile.favorited_submissions.count }}</dd>

                        <dt>Ratings</dt>
                        <dd>{{ user_profile.rating_set.count }}</dd>

                        <dt>Enjoy votes</dt>
                        <dd>{{ user_profile.enjoyitem_set.count }}</dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>
{% endif %}
{% endblock %}
